<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A - 6ê³¼ ë‹¨ì–´ ê²Œì„</title>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f0fdf4; /* 6ê³¼ í…Œë§ˆ: ìƒì¾Œí•œ ê·¸ë¦°/ë¸”ë£¨ í†¤ */
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .game-container {
            background: #ffffff;
            width: 100%;
            max-width: 600px;
            padding: 25px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
        }
        @media (min-width: 600px) {
            .game-container {
                min-height: auto;
                margin: 30px 0;
                border-radius: 24px;
                border: 1px solid #e5e7eb;
            }
        }
        
        /* Header */
        h1 { font-size: 1.5rem; text-align: center; margin: 5px 0 5px; color: #166534; letter-spacing: -0.5px; }
        .subtitle { text-align: center; font-size: 0.95rem; color: #6b7280; margin-bottom: 25px; }
        
        /* Controls */
        .top-ctrl { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-bottom: 20px; 
            background: #f3f4f6;
            padding: 12px;
            border-radius: 16px;
        }
        .direction-label { 
            font-weight: 700; 
            font-size: 1rem; 
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .direction-label:hover { opacity: 0.7; }

        /* Stats */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px; 
            margin-bottom: 20px; 
        }
        .stat-box {
            background: #fff;
            border: 2px solid #f3f4f6;
            border-radius: 16px;
            padding: 12px 5px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .stat-label { font-size: 0.8rem; color: #9ca3af; margin-bottom: 4px; font-weight: 600; }
        .stat-value { font-size: 1.4rem; font-weight: 800; color: #1f2937; }
        .stat-value.score { color: #16a34a; } /* Green for score */
        
        /* Question Card */
        .card { 
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); 
            border-radius: 20px; 
            padding: 40px 20px; 
            margin-bottom: 25px; 
            text-align: center; 
            box-shadow: inset 0 2px 4px 0 rgba(255, 255, 255, 0.5);
            border: 1px solid #a7f3d0;
            position: relative;
            overflow: hidden;
        }
        .question-text { 
            font-size: 2.2rem; 
            font-weight: 800; 
            color: #064e3b; 
            margin-bottom: 10px; 
            word-break: keep-all; 
            line-height: 1.2; 
            position: relative;
            z-index: 2;
        }
        .lang-hint { 
            font-size: 0.9rem; 
            color: #059669; 
            font-weight: 700; 
            letter-spacing: 1px; 
            text-transform: uppercase;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        /* Decorative circle behind text */
        .card::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 150px; height: 150px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            z-index: 1;
        }

        /* Options Grid */
        #options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .option-btn {
            padding: 15px 10px; 
            font-size: 1.15rem; 
            border-radius: 16px;
            border: 2px solid #e5e7eb; 
            background: #ffffff; 
            color: #374151;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1); 
            word-break: keep-all; 
            min-height: 80px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-weight: 600;
            box-shadow: 0 2px 0 #e5e7eb;
            line-height: 1.3;
        }
        .option-btn:hover:not(:disabled) { 
            border-color: #34d399; 
            background: #f0fdf4; 
            transform: translateY(-2px); 
            box-shadow: 0 4px 0 #34d399;
        }
        .option-btn:active:not(:disabled) { 
            transform: translateY(0); 
            box-shadow: 0 0 0; 
        }
        
        .option-btn.correct { 
            background: #dcfce7 !important; 
            border-color: #22c55e !important; 
            color: #14532d !important; 
            box-shadow: 0 0 0 2px #bbf7d0 !important; 
        }
        .option-btn.wrong { 
            background: #fee2e2 !important; 
            border-color: #ef4444 !important; 
            color: #7f1d1d !important; 
            opacity: 0.6;
            box-shadow: none !important;
        }

        /* Next Button */
        #next-btn {
            width: 100%; padding: 18px; font-size: 1.2rem;
            background: #10b981; color: white; border: none; border-radius: 16px;
            cursor: pointer; font-weight: 800;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #059669;
            margin-top: 10px;
        }
        #next-btn:disabled { 
            background: #d1d5db; 
            color: #9ca3af;
            cursor: not-allowed; 
            box-shadow: none; 
            transform: translateY(2px);
        }
        #next-btn:hover:not(:disabled) { background: #059669; transform: translateY(-2px); box-shadow: 0 6px 0 #047857; }
        #next-btn:active:not(:disabled) { transform: translateY(0); box-shadow: 0 0 0; }

        /* Message Area */
        #message {
            text-align: center; 
            min-height: 30px; 
            font-weight: 700; 
            margin: 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Celebration Overlay */
        .overlay { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(5px);
            display: none; 
            align-items: center; justify-content: center; 
            z-index: 100; 
            padding: 20px;
        }
        .overlay.show { display: flex; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .celebrate-card { 
            background: white; 
            padding: 40px 30px; 
            border-radius: 30px; 
            text-align: center; 
            max-width: 400px; 
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.9);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn { to { transform: scale(1); } }

        .confetti { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 1; }
        .confetti span {
            position: absolute; width: 10px; height: 10px; 
            animation: fall 3s linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        .celebrate-btn {
            margin-top: 25px;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 800;
            background: #4f46e5;
            color: white;
            width: 100%;
            box-shadow: 0 4px 0 #3730a3;
            transition: transform 0.1s;
        }
        .celebrate-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A - 6ê³¼</h1>
        <div class="subtitle">ê³µì—°ê³¼ ì¶•ì œ ì–´íœ˜ (ì´ <span id="total-words">0</span>ë‹¨ì–´)</div>

        <div class="top-ctrl">
            <label class="direction-label">
                <input type="radio" name="direction" value="vi2ko" checked> 
                ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨ì–´ â†’ ğŸ‡°ğŸ‡· í•œêµ­ì–´
            </label>
            <label class="direction-label">
                <input type="radio" name="direction" value="ko2vi"> 
                ğŸ‡°ğŸ‡· í•œêµ­ì–´ â†’ ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨ì–´
            </label>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-label">ì§„í–‰</span>
                <span class="stat-value"><span id="q-num">1</span></span>
            </div>
            <div class="stat-box">
                <span class="stat-label">ë‚¨ì€ ë‹¨ì–´</span>
                <span class="stat-value" id="words-left">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">ì ìˆ˜</span>
                <span class="stat-value score" id="current-score">0</span>
            </div>
        </div>

        <div class="card">
            <div class="lang-hint" id="lang-label">Ready?</div>
            <div class="question-text" id="q-text">ì‹œì‘!</div>
        </div>

        <div id="options"></div>
        <div id="message"></div>
        <button id="next-btn" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
    </div>

    <!-- Celebration Overlay -->
    <div class="overlay" id="overlay">
        <div class="confetti" id="confetti-container"></div>
        <div class="celebrate-card">
            <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ†</div>
            <h2 style="font-size: 2rem; margin: 0 0 10px; color: #10b981;" id="cel-title">ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <p style="font-size: 1.2rem; color: #4b5563; line-height: 1.6;" id="cel-body">ëª©í‘œ ì ìˆ˜ë¥¼ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
            <button class="celebrate-btn" id="cel-btn" onclick="handleContinue()">ê³„ì† í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // 6ê³¼ ì–´íœ˜ ë°ì´í„° (í•œêµ­ì–´, ë² íŠ¸ë‚¨ì–´)
        const WORDS_ALL = [
            ["ì„¤ëª…ì´ í•„ìš” ì—†ë‹¤", "khÃ´ng cáº§n giáº£i thÃ­ch"], ["ë³¼ê±°ë¦¬", "cÃ¡i Ä‘á»ƒ xem"], 
            ["ì´ì•¼ê¹ƒê±°ë¦¬", "cÃ¢u chuyá»‡n"], ["ì›ƒìŒê±°ë¦¬", "chuyá»‡n cÆ°á»i"], 
            ["ê±±ì •ê±°ë¦¬", "má»‘i lo"], ["ê´€ì‹¬ê±°ë¦¬", "má»‘i quan tÃ¢m"], 
            ["êµí¬", "kiá»u bÃ o"], ["ë°œë¼ë“œ", "báº£n ballad"], 
            ["ëŒ€ë‹¨í•˜ë‹¤", "giá»i, xuáº¥t sáº¯c"], ["ê°ë™ì ì´ë‹¤", "cáº£m Ä‘á»™ng"], 
            ["ì§€ë£¨í•˜ë‹¤", "chÃ¡n"], ["ì‹ ì´ ë‚˜ë‹¤", "há»©ng thÃº"], 
            ["ê°€ìŠ´ì´ ì°¡í•˜ë‹¤", "ngháº¹n ngÃ o"], ["ìˆ˜ì¤€ì´ ë†’ë‹¤", "tiÃªu chuáº©n cao"], 
            ["ê¸°ëŒ€ë§Œ ëª»í•˜ë‹¤", "khÃ´ng Ä‘áº¡t Ä‘Æ°á»£c kÃ¬ vá»ng"], ["ì´í•´ê°€ ì•ˆ ë˜ë‹¤", "khÃ´ng hiá»ƒu"], 
            ["ëŒ„ìŠ¤ê³¡", "nháº¡c dance"], ["íŒë§¤", "viá»‡c bÃ¡n hÃ ng"], 
            ["ê·¼ë¬´ì§€", "nÆ¡i lÃ m viá»‡c"], ["ì¥ê¸° ìë‘", "cuá»™c thi tÃ i nÄƒng"], 
            ["í™í•©", "hip-hop"], ["íƒ­ ëŒ„ìŠ¤", "nháº£y thiáº¿t hÃ i"], 
            ["ë§ˆìˆ ", "ma thuáº­t"], ["ë¯¼ì† ê³µì—°", "biá»ƒu diá»…n dÃ¢n gian"], 
            ["ì¡´ê²½í•˜ë‹¤", "tÃ´n trá»ng"], ["ë¬¸ì", "chá»¯"], 
            ["ëŒ€í‘œí•˜ë‹¤", "Ä‘áº¡i diá»‡n"], ["ì˜ˆìˆ í’ˆ", "tÃ¡c pháº©m nghá»‡ thuáº­t"], 
            ["ì‹ ê²½ ì“°ë‹¤", "quan tÃ¢m"], ["í•˜ì´ì„œìš¸í˜ìŠ¤í‹°ë²Œ", "lá»… há»™i Hi! Seoul Festival"], 
            ["ê³³ê³³", "má»i nÆ¡i"], ["ì§„í–‰ë˜ë‹¤", "Ä‘Æ°á»£c tá»• chá»©c"], 
            ["ê°ìƒí•˜ë‹¤", "cáº£m thá»¥, thÆ°á»Ÿng thá»©c"], ["ì”ì¹˜", "bá»¯a tiá»‡c"], 
            ["í™”ë ¤í•˜ë‹¤", "rá»±c rá»¡"], ["ë¶ˆê½ƒë†€ì´", "phÃ¡o hoa"], 
            ["ì‚¬ë¬¼ë†€ì´", "samulnori"], ["ì—°ì£¼íŒ€", "Ä‘á»™i biá»ƒu diá»…n"], 
            ["êµ­ë¦½êµ­ì•…ë‹¨", "Ä‘oÃ n biá»ƒu diá»…n nghá»‡ thuáº­t truyá»n thá»‘ng"], ["ë¹„ë³´ì´", "B-boy"], 
            ["í•œìë¦¬", "má»™t chá»—"], ["ì–´ìš°ëŸ¬ì§€ë‹¤", "hÃ²a há»£p"], 
            ["ê¸°íšŒë¥¼ ë†“ì¹˜ë‹¤", "vuá»™t máº¥t cÆ¡ há»™i"], ["ë³´ë ¹", "thÃ nh phá»‘ Boryeong"], 
            ["ë¨¸ë“œ ì¶•ì œ", "lá»… há»™i bÃ¹n"], ["ì­í¬ë€", "lá»… há»™i Songkran"], 
            ["í•˜ì–¼ë¹ˆ", "CÃ¡p NhÄ© TÃ¢n"], ["ë¹™ë“±ì œ", "lá»… há»™i bÄƒng"], 
            ["ì‚¼ë°”", "Ä‘iá»‡u nháº£y Samba"], ["ì¶©ë‚¨", "Chungnam"], 
            ["ëŒ€ì²œ", "Daecheon"], ["í•´ìˆ˜ìš•ì¥", "bÃ£i biá»ƒn"], 
            ["í¼ì³ì§€ë‹¤", "Ä‘Æ°á»£c tráº£i ra"], ["êµ­ë‚´ì™¸", "trong vÃ  ngoÃ i nÆ°á»›c"], 
            ["ê´€ê´‘ê°", "khÃ¡ch du lá»‹ch"], ["ëª°ë ¤ë“¤ë‹¤", "dá»“n vÃ o"], 
            ["ë¯¸ë„ëŸ¼í‹€", "cáº§u trÆ°á»£t"], ["ìœ íŠœë¸Œ", "Youtube"], 
            ["ì²´í—˜ í”„ë¡œê·¸ë¨", "chÆ°Æ¡ng trÃ¬nh tráº£i nghiá»‡m"], ["ìš”íŠ¸", "thuyá»n yat"], 
            ["ë°˜ì‘", "sá»± pháº£n á»©ng"], ["ê¶ì¤‘ ìŒì•…", "Ã¢m nháº¡c cung Ä‘Ã¬nh"], 
            ["ë¶€ì±„ì¶¤", "mÃºa quáº¡t"], ["ì¸ìƒì ì´ë‹¤", "áº¥n tÆ°á»£ng"], 
            ["ìš°ì•„í•˜ë‹¤", "trang nhÃ£"], ["ì¶¤ë™ì‘", "Ä‘á»™ng tÃ¡c mÃºa"], 
            ["íŒì†Œë¦¬", "Pansori"], ["ì •ì„œ", "tÃ¬nh cáº£m"], 
            ["ê°•ê°•ìˆ ë˜", "Ä‘iá»‡u mÃºa vÃ²ng trÃ²n"], ["K-íŒ", "K-pop"], 
            ["ê³µí¬ ì˜í™”", "phim kinh dá»‹"], ["ë©œë¡œ ì˜í™”", "phim tÃ¬nh cáº£m"], 
            ["ì¬ì¦ˆ", "nháº¡c jazz"], ["ì€ê·¼íˆ", "má»™t cÃ¡ch tháº§m láº·ng"], 
            ["ë„˜ì–´ê°€ë‹¤", "vÆ°á»£t qua"], ["ì„", "ngÆ°á»i áº¥y"], 
            ["ë¦¬", "lÃ­ (Ä‘Æ¡n vá»‹ Ä‘o)"], ["ë°œë³‘", "sá»± phÃ¡t bá»‡nh"], 
            ["ì™ ì§€ ëª¨ë¥´ê²Œ", "khÃ´ng hiá»ƒu vÃ¬ sao"], ["ë¯¼ìš”", "dÃ¢n ca"], 
            ["ì§€ì—­", "khu vá»±c"], ["ê²½ê¸°", "Gyeonggi"], 
            ["ë°€ì–‘", "Miryang"], ["ì§„ë„", "Ä‘áº£o Jindo"], 
            ["ì •ì„ ", "Jeongseon"], ["ë„ë¦¬", "rá»™ng rÃ£i"], 
            ["ë°©ì‹", "phÆ°Æ¡ng thá»©c"], ["ì‹ ì„ í•˜ë‹¤", "tÆ°Æ¡i"], 
            ["ìƒˆë¡­ë‹¤", "má»›i"], ["ìœ ë„¤ìŠ¤ì½”", "UNESCO"], 
            ["ì¸ë¥˜ ë¬´í˜• ìœ ì‚°", "di sáº£n vÄƒn hÃ³a phi váº­t thá»ƒ"], ["ê°€ì‚¬", "lá»i bÃ i hÃ¡t"], 
            ["ê±°ì§€", "Äƒn xin"], ["ì–µìˆ˜ ì¥ë§ˆ", "mÆ°a nhÆ° trÃºt nÆ°á»›c"], 
            ["ë§Œìˆ˜ì‚°", "nÃºi Mansu"], ["ë¬¸ê²½ ìƒˆì¬", "Mungyeong Saejae"], 
            ["ë™ì§€ì„£ë‹¬", "thÃ¡ng 11, 12 Ã¢m lá»‹ch"]
        ];

        document.getElementById("total-words").textContent = WORDS_ALL.length;

        // --- ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ (Web Audio API) ---
        // ë³„ë„ì˜ íŒŒì¼ ë¡œë”© ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì†Œë¦¬ë¥¼ í•©ì„±í•©ë‹ˆë‹¤.
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playTone(freq, type, duration, startTime = 0, vol = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + startTime);
            
            gain.gain.setValueAtTime(vol, audioCtx.currentTime + startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + startTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + startTime);
            osc.stop(audioCtx.currentTime + startTime + duration);
        }

        function playCorrectSound() {
            // ë”©-ë™ (High pitch)
            playTone(880, 'sine', 0.6, 0); // A5
            playTone(1108, 'sine', 0.8, 0.1); // C#6
        }

        function playComboSound() {
            // í™”ë ¤í•œ ë ë§~ (Major Arpeggio)
            const now = 0;
            playTone(880, 'triangle', 0.3, now);      // A5
            playTone(1108, 'triangle', 0.3, now+0.08); // C#6
            playTone(1318, 'triangle', 0.3, now+0.16); // E6
            playTone(1760, 'triangle', 0.6, now+0.24); // A6
        }

        function playWrongSound() {
            // ë¡! (Low Buzz)
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(80, audioCtx.currentTime + 0.3);
            
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playFanfareSound() {
            // ë¹ ë°”ë°¤~ (Fanfare Melody)
            const now = 0;
            const type = 'square';
            const vol = 0.1;
            // C G E C G C
            playTone(523.25, type, 0.2, now, vol);     // C5
            playTone(659.25, type, 0.2, now+0.15, vol); // E5
            playTone(783.99, type, 0.2, now+0.30, vol); // G5
            playTone(1046.50, type, 0.8, now+0.45, vol); // C6
            
            // Background harmony
            setTimeout(() => {
                playTone(523.25, 'sine', 1.0, 0, 0.05);
                playTone(783.99, 'sine', 1.0, 0, 0.05);
            }, 0);
        }

        // --- ê²Œì„ ë¡œì§ ---
        let score = 0;
        let questionCount = 1;
        let direction = "vi2ko";
        let deck = [];
        let streak = 0;
        
        // ** ì¤‘ë³µ ì¶œì œ ë°©ì§€ ë³€ìˆ˜ **
        let lastWordIdx = -1;
        
        // ëª©í‘œ ì ìˆ˜ ì„¤ì •: 100, 200, 300
        const MILESTONES = [100, 200, 300];
        let nextMilestoneIdx = 0;

        // ìš”ì†Œ ì°¸ì¡°
        const qText = document.getElementById("q-text");
        const langLabel = document.getElementById("lang-label");
        const optionsDiv = document.getElementById("options");
        const nextBtn = document.getElementById("next-btn");
        const scoreEl = document.getElementById("current-score");
        const qNumEl = document.getElementById("q-num");
        const wordsLeftEl = document.getElementById("words-left");
        const messageEl = document.getElementById("message");
        
        // ì˜¤ë²„ë ˆì´ ìš”ì†Œ
        const overlay = document.getElementById("overlay");
        const celTitle = document.getElementById("cel-title");
        const celBody = document.getElementById("cel-body");
        const celBtn = document.getElementById("cel-btn");

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function rebuildDeck() {
            deck = Array.from({ length: WORDS_ALL.length }, (_, i) => i);
            shuffle(deck);
        }

        function getNextWord() {
            if (deck.length === 0) rebuildDeck();
            
            // ** ì—°ì† ì¶œì œ ë°©ì§€ ë¡œì§ **
            // ë±ì—ì„œ êº¼ë‚¼ ì˜ˆì •ì¸ ì¹´ë“œ(ë§ˆì§€ë§‰ ìš”ì†Œ)ê°€ ì§ì „ ë¬¸ì œ(lastWordIdx)ì™€ ê°™ë‹¤ë©´
            // ê·¸ ì•ì˜ ì¹´ë“œì™€ ìˆœì„œë¥¼ ë°”ê¿ˆ (ë±ì— ì¹´ë“œê°€ 2ì¥ ì´ìƒì¼ ë•Œë§Œ ê°€ëŠ¥)
            if (deck.length > 1) {
                const nextIdx = deck[deck.length - 1];
                if (nextIdx === lastWordIdx) {
                    // swap
                    [deck[deck.length - 1], deck[deck.length - 2]] = [deck[deck.length - 2], deck[deck.length - 1]];
                }
            }
            
            const idx = deck.pop();
            lastWordIdx = idx; // ì´ë²ˆ ë¬¸ì œ ì¸ë±ìŠ¤ ì €ì¥
            return WORDS_ALL[idx];
        }

        function updateStats() {
            scoreEl.textContent = score;
            qNumEl.textContent = questionCount;
            wordsLeftEl.textContent = deck.length;
        }

        function newQuestion() {
            nextBtn.disabled = true;
            messageEl.textContent = "";

            const correctWord = getNextWord(); // [Ko, Vi]
            const q = direction === "vi2ko" ? correctWord[1] : correctWord[0]; // ì§ˆë¬¸ í…ìŠ¤íŠ¸
            const ans = direction === "vi2ko" ? correctWord[0] : correctWord[1]; // ì •ë‹µ í…ìŠ¤íŠ¸

            langLabel.textContent = direction === "vi2ko" ? "Tiáº¿ng Viá»‡t" : "í•œêµ­ì–´";
            qText.textContent = q;

            // ì˜¤ë‹µ ë³´ê¸° ìƒì„±
            const pool = WORDS_ALL.map(w => direction === "vi2ko" ? w[0] : w[1])
                                  .filter(v => v !== ans);
            shuffle(pool);
            let choices = [ans, pool[0], pool[1], pool[2]];
            shuffle(choices);

            optionsDiv.innerHTML = "";
            choices.forEach(choice => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.textContent = choice;
                btn.onclick = () => checkAnswer(choice, ans, btn);
                optionsDiv.appendChild(btn);
            });
            
            updateStats();
        }

        function createConfetti() {
            const container = document.getElementById("confetti-container");
            container.innerHTML = "";
            const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];
            
            for (let i = 0; i < 80; i++) {
                const span = document.createElement("span");
                span.style.left = Math.random() * 100 + "%";
                span.style.top = -10 + "px";
                span.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                span.style.animationDelay = Math.random() * 2 + "s";
                span.style.animationDuration = (2 + Math.random() * 2) + "s";
                container.appendChild(span);
            }
        }

        function showMilestone(milestone) {
            playFanfareSound();
            createConfetti();
            overlay.classList.add("show");
            
            if (milestone === 300) {
                celTitle.textContent = "ğŸ† ì „ì„¤ì˜ ë“±ê·¹! 300ì ! ğŸ†";
                celTitle.style.color = "#f59e0b"; // Gold color
                celBody.innerHTML = "ì™€ìš°! 300ì ì„ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤.<br>ë‹¹ì‹ ì€ ì§„ì •í•œ ë‹¨ì–´ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.";
                celBtn.textContent = "ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°";
                celBtn.onclick = () => location.reload();
            } else {
                celTitle.textContent = `ğŸ‰ ${milestone}ì  ëŒíŒŒ! ğŸ‰`;
                celTitle.style.color = "#10b981";
                celBody.textContent = `ì¶•í•˜í•©ë‹ˆë‹¤! ${milestone}ì ì— ë„ë‹¬í•˜ì…¨ìŠµë‹ˆë‹¤.`;
                celBtn.textContent = "ê³„ì† ë„ì „í•˜ê¸°";
                celBtn.onclick = handleContinue;
            }
        }

        function handleContinue() {
            overlay.classList.remove("show");
            // ë‹¤ìŒ ë¬¸ì œë¡œ ë°”ë¡œ ì§„í–‰
            questionCount++;
            newQuestion();
        }

        function checkAnswer(selected, correct, btn) {
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
            const allBtns = document.querySelectorAll(".option-btn");
            allBtns.forEach(b => b.disabled = true);

            if (selected === correct) {
                // ì ìˆ˜ ë¡œì§ (ìˆ˜ì •ë¨)
                // streak: ì´ì „ ë¬¸ì œê¹Œì§€ ì—°ì† ì •ë‹µ íšŸìˆ˜
                // streak 0 -> ì²« ì •ë‹µ -> 1ì 
                // streak 1 -> ë‘ ë²ˆì§¸ ì—°ì† ì •ë‹µ (2ì½¤ë³´) -> 2ì 
                // streak 2 ì´ìƒ -> ì„¸ ë²ˆì§¸ ì´ìƒ ì—°ì† ì •ë‹µ (3ì½¤ë³´) -> 3ì  (ìµœëŒ€)

                let gained = 1;
                let msgText = "";
                let msgColor = "";

                if (streak >= 2) {
                    gained = 3;
                    msgText = `ğŸ”¥ 3ì½¤ë³´ ì´ìƒ! +${gained}ì !`;
                    msgColor = "#b45309"; // ì§„í•œ ì£¼í™©/ê°ˆìƒ‰
                    playComboSound();
                } else if (streak === 1) {
                    gained = 2;
                    msgText = `âš¡ 2ì½¤ë³´! +${gained}ì !`;
                    msgColor = "#059669"; // ë…¹ìƒ‰
                    playComboSound();
                } else {
                    gained = 1;
                    msgText = `ì •ë‹µì…ë‹ˆë‹¤! +${gained}ì `;
                    msgColor = "#166534"; // ì§™ì€ ë…¹ìƒ‰
                    playCorrectSound();
                }

                score += gained;
                streak += 1;
                
                btn.classList.add("correct");
                messageEl.innerHTML = `<span style="color:${msgColor}; font-weight:bold;">${msgText}</span>`;
                
                updateStats();

                // ë§ˆì¼ìŠ¤í†¤(100, 200, 300) ì²´í¬
                // í˜„ì¬ ì„¤ì •ëœ ë‹¤ìŒ ëª©í‘œê°€ ìˆê³ , ì ìˆ˜ê°€ ê·¸ ëª©í‘œë¥¼ ë„˜ì—ˆì„ ë•Œ
                if (nextMilestoneIdx < MILESTONES.length && score >= MILESTONES[nextMilestoneIdx]) {
                    const milestone = MILESTONES[nextMilestoneIdx];
                    nextMilestoneIdx++; // ë‹¤ìŒ ëª©í‘œë¡œ ì¸ë±ìŠ¤ ì¦ê°€
                    
                    // ì •ë‹µ í™•ì¸ ì‹œê°„ì„ ì¡°ê¸ˆ ì¤€ ë’¤ ì¶•í•˜ í™”ë©´ í‘œì‹œ
                    setTimeout(() => {
                        showMilestone(milestone);
                    }, 500);
                    return; // "ë‹¤ìŒ ë¬¸ì œ" ë²„íŠ¼ í™œì„±í™” í•˜ì§€ ì•Šê³  ì˜¤ë²„ë ˆì´ì—ì„œ ì²˜ë¦¬
                }

            } else {
                // ì˜¤ë‹µ ë¡œì§
                playWrongSound();
                btn.classList.add("wrong");
                streak = 0; // ì—°ì† ì •ë‹µ ì´ˆê¸°í™”
                messageEl.innerHTML = `<span style="color:#dc2626">í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µ: <b>${correct}</b></span>`;
            }

            // ë§ˆì¼ìŠ¤í†¤ì´ ì•„ë‹ˆë©´ ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í™œì„±í™”
            nextBtn.disabled = false;
        }

        nextBtn.onclick = () => {
            questionCount++;
            newQuestion();
        };

        // ë°©í–¥ ì „í™˜ (í•œ<->ë² )
        document.querySelectorAll('input[name="direction"]').forEach(r => {
            r.onchange = (e) => {
                direction = e.target.value;
                // ê²Œì„ ë¦¬ì…‹
                score = 0;
                streak = 0;
                questionCount = 1;
                nextMilestoneIdx = 0;
                lastWordIdx = -1; // ë¦¬ì…‹ ì‹œ ì´ì „ ë‹¨ì–´ ê¸°ë¡ë„ ì´ˆê¸°í™”
                scoreEl.textContent = "0";
                qNumEl.textContent = "1";
                rebuildDeck();
                newQuestion();
            };
        });

        // ì´ˆê¸°í™”
        rebuildDeck();
        newQuestion();

    </script>
</body>
</html>
